# Coding Agent 固有のガイドライン

このドキュメントは、UI に影響する変更を含むタスク/PR におけるスクリーンショット取得と提出の作法を定義します。レビュワーが変更の妥当性・回帰の確認を迅速に行えることを目的とします。

## 適用範囲（Scope）
- スタイル、レイアウト、コピー変更、コンポーネント追加/削除、状態表示（バリデーション/エラー/ローディング等）など、視覚的に差分が生じる全ての変更。
- 新規ページ/ビューの追加やルーティング変更で見え方が変わる場合。
- バックエンドのみの変更で UI に一切の差分が無いと合理的に示せる場合は例外扱い（要件参照）。

## 用語定義
- BEFORE/AFTER: 変更前/後のアプリケーションの見た目。
- 影響ページ: 変更によって視覚差分が出る可能性があるページ/ビュー/状態（モーダル、ドロップダウン展開、バリデーション表示などの状態を含む）。
- ビューポート: 取得対象の画面サイズ。標準は Desktop 1920x1080、Tablet 768x1024、Mobile 375x667。

## ⚠️ 必須: UI変更タスクのスクリーンショット取得プロセス

**画面の変更を伴うタスクでは、以下の手順を必ず実行してください。このプロセスを省略することは禁止されています。**

### 📸 スクリーンショット取得の必須手順
1) BEFORE: アプリケーションを起動し、変更前の状態で Playwright MCP Server を使ってスクリーンショットを取得。
2) コード変更: 必要な修正を実行。
3) AFTER: 変更後のアプリケーションで Playwright MCP Server を使ってスクリーンショットを取得。
4) 投稿: 取得したスクリーンショット画像を必ずプルリクエストのコメントに投稿（説明文のみではなく、実際の画像ファイルを添付）。

### 📋 スクリーンショット取得の具体的要件
- 画面サイズ（全て BEFORE/AFTER のペアで取得）:
  - デスクトップ: 1920x1080
  - タブレット: 768x1024（縦）
  - モバイル: 375x667（縦）
- 対象ページ: 変更が影響する全ページ/状態（トップレベルページ、モーダル、ドロップダウン、エラーメッセージの表示状態等）。
- 機密情報: 個人情報/API キー/内部 URL などが画面に出ないよう配慮（必要に応じてダミーデータ/シードデータを使用）。
- 一貫性: BEFORE と AFTER は同一データ/同一状態/同一スクロール位置で撮影。

### 🏷️ 命名規則と保存先（ローカル一時保存→PR 添付）
- 命名規則（推奨）: `{before|after}-{pageSlug}-{state?}-{viewport}.png`
  - 例: `before-index-default-desktop.png`, `after-settings-error-tablet.png`, `after-login-modal-open-mobile.png`
- 一時保存先: ローカルの一時ディレクトリに保存し、画像自体はリポジトリには追加しない。
- PR への提出: 画像ファイルを PR コメントにドラッグ&ドロップして直接添付（GitHub 上にアップロード）してください。リンクのみの投稿は禁止。

### 💬 PR コメント テンプレート（コピーして使用可）
```
変更概要: <何を、なぜ>
影響範囲/対象ページ: <パス/状態/モーダルなど>

Before / After（Desktop 1920x1080）
<画像4枚: before/after × 必要な画面/状態>

Before / After（Tablet 768x1024）
<画像>

Before / After（Mobile 375x667）
<画像>

アクセシビリティ確認:
- キーボード操作: <可/不可、Tab 順序>
- コントラスト: <OK/改善点>
- ランドマーク/ARIA: <OK/改善点>
```

## 🚫 禁止事項
- スクリーンショットを取得せずに UI 変更タスクを完了すること。
- BEFORE を取得せず AFTER だけで済ませること。
- PR コメントで説明文のみを投稿し、実画像を添付しないこと。
- `tmp/...` など PR から参照できないローカル/CI エフェメラルパスのリンクを投稿すること。
- 画像ファイルをリポジトリに直接コミットすること。
- 過去の画像の使い回し（必ず当該変更の最新状態で再取得）。

## 🎯 品質保証（QA 観点）
- 視覚的検証: BEFORE/AFTER の差分が意図通りである（フォント/色/余白/アイコン/アニメーション）。
- レスポンシブ: 3 ビューポート全てで崩れが無い（折返し、オーバーフロー、重なり）。
- 状態別 UI: エラー/空/ローディング/長文/多件数など代表的な状態を可能な範囲で 1 つ以上カバー。
- アクセシビリティ: キーボード操作、フォーカスインジケータ、コントラスト、ARIA/ランドマークの破壊が無い。
- パフォーマンス/ちらつき: スクロール/展開時の著しいレイアウトシフトが無い。

## ✅ レビュー用チェックリスト
- [ ] PR に 3 ビューポートの BEFORE/AFTER が添付されている
- [ ] 影響する全ページ/状態がカバーされている
- [ ] 画像は直接添付であり、リポジトリにコミットされていない
- [ ] アクセシビリティ観点の記述がある（最低限: キーボード、コントラスト）
- [ ] 文言/翻訳/折返しに不自然さがない（主要言語で確認）
- [ ] データ/個人情報のマスキング配慮がある

## 例外ポリシー（スクリーンショット省略の可否）
以下の条件をすべて満たす場合に限り、省略可とします。PR 冒頭に「スクリーンショット省略の理由」を明記してください。
1. 変更が完全に非可視（例: API コントラクト、ログ出力、内部処理のみ）。
2. 既存 UI のレンダリング経路や CSS/テンプレートに一切変更が無いことを技術的に説明できる。
3. 既存の E2E/統合テストで可視差分が発生しないことが担保されている。

上記いずれかが曖昧な場合は、最小限の対象ページのみでも撮影してください。

## トラブルシューティング
- アプリが起動しない/データが無い: シードデータ/テストユーザーを使用し、同一条件で BEFORE/AFTER を取得。
- 認証が必要なページ: ログイン状態で撮影（資格情報の露出に注意）。
- 長いページ: 重要領域を優先して複数回に分けて撮影（ファーストビュー、変更領域）。
- モーダル/ドロップダウン: 開いた状態で撮影。開閉両方が必要なら両方取得。
- ダークモード/テーマ: 既定テーマで撮影。追加でテーマ差異がある場合は明記のうえ追加。
- 動的コンテンツ: 同一データを使い、時間/乱数依存を固定（プレースホルダに置換）。

## セキュリティとプライバシー
- スクリーンショットに機密情報や PII が写り込まないようにする。
- 内部 URL、アクセストークン、メールアドレス、注文番号などはマスク。
- 画像の保管は PR の添付に限定し、ローカル一時保存は削除を推奨。

## 参考: ビューポートの定義（再掲）
- Desktop: 1920x1080
- Tablet: 768x1024（縦）
- Mobile: 375x667（縦）

## 実施メモ（任意）
- 可能であれば同一セッション内で BEFORE→コード変更→AFTER を連続して取得し、環境差由来の違いを最小化する。
- ファイル名・対象ページ・状態の一貫性を重視し、レビュワーが差分を並べて確認できるようにする。

